<!DOCTYPE html>
<html lang=en>
<head>
<!-- <script src = "https://cdn.rawgit.com/mrdoob/three.js/r84/build/three.js"></script> -->
<script src = "https://cdn.rawgit.com/mrdoob/three.js/r94/build/three.js"></script>
<!-- <script src = "https://sdk.altvr.com/libs/altspace.js/2.9.0/altspace.min.js"></script> -->

<script src="https://cdn.rawgit.com/mrdoob/three.js/r94/examples/js/loaders/MTLLoader.js"></script>
<script src="https://cdn.rawgit.com/mrdoob/three.js/r94/examples/js/loaders/OBJLoader.js"></script>
<script src="https://altspacevr.github.io/AltspaceSDK/dist/altspace.js"></script>

<script src = "https://cdnjs.cloudflare.com/ajax/libs/tween.js/16.3.5/Tween.min.js"></script>
<script src = "https://cdn.rawgit.com/NGenesis/altspacevr-behaviors/v1.0.0/js/altspaceutil.min.js"></script>
<script src = "../../console/Console.js"></script>

<script src = "pet.js"></script>
<script src = "PetBehaviors.js"></script>
</head>
<body>
<script>

var bbBallTextureURL = "https://cmdrflexo.github.io/AltspaceSDK-Flexo/examples/flexo/flexorama/pet/bb.png";
var bbHeadTextureURL = "https://cmdrflexo.github.io/AltspaceSDK-Flexo/examples/flexo/flexorama/pet/bb-head.png";
var grassTextureURL = "https://cmdrflexo.github.io/AltspaceSDK-Flexo/examples/flexo/flexorama/textures/16x16_grass.png";
var boxTextureURL = "https://cmdrflexo.github.io/AltspaceSDK-Flexo/examples/flexo/flexorama/textures/16x16_box.png";

// var config = { authorId : "Flexo", appId : "180623-01" };
altspaceutil.getFullspaceEnclosure().then(function(enclosure) { 
    start();
    // altspace.utilities.sync.connect(config).then(
    //     function(connection) {
    //         start();
    //         // Demo.main(connection);
    //     }
    // );
});

var sim;
var sceneConsole;

function start() {
    sim = new altspace.utilities.Simulation();

    sim.scene.add(CreateTerrain());

    var dogModelURL = "https://cmdrflexo.github.io/AltspaceSDK-Flexo/examples/flexo/flexorama/models/dog/"
    // head
    loadModel(
        dogModelURL + "uv_box.obj",
        dogModelURL + "box_head.mtl",
        new THREE.Vector3(0, 0, 0),
        new THREE.Vector3(6, 6, 4),
        (1 / 16) * 0.66
    );
    // snout
    loadModel(
        dogModelURL + "uv_box.obj",
        // dogModelURL + "box_head_snout.mtl",
        dogModelURL + "box_head.mtl",
        new THREE.Vector3(-1, 0, 2),
        new THREE.Vector3(3, 3, 3),
        (1 / 16) * 0.66
    );
    // ear L
    loadModel(
        dogModelURL + "uv_box.obj",
        // dogModelURL + "box_head_ear_l.mtl",
        dogModelURL + "box_head.mtl",
        new THREE.Vector3(-2, 4, -1),
        new THREE.Vector3(2, 2, 1),
        (1 / 16) * 0.66
    );
    // ear R
    loadModel(
        dogModelURL + "uv_box.obj",
        // dogModelURL + "box_head_ear_r.mtl",
        dogModelURL + "box_head.mtl",
        new THREE.Vector3(2, 4, -1),
        new THREE.Vector3(2, 2, 1),
        (1 / 16) * 0.66
    );

    // altspace.getThreeJSTrackingSkeleton().then(function(_skeleton) {
    //     var skeleton = _skeleton;
    //     sim.scene.add(skeleton);
    //     var head = skeleton.getJoint("Head");
    //     var dog = CreateDogFollower(head, 0.04125);
    // });
}

// var connection;
// var sceneSync;
var item;
var itemModel;

function loadModel(objFilename, mtlFilename, position, size, scale) {
    var loader = new altspace.utilities.shims.OBJMTLLoader();
    loader.load(
        objFilename, mtlFilename, 
        function(obj) {
            obj.position.x = position.x * scale;
            obj.position.y = position.y * scale;
            obj.position.z = position.z * scale;
            obj.rotation.y = THREE.Math.deg2Rad(180);
            obj.scale.set(size.x * scale, size.y * scale, size.z * scale);
            sim.scene.add(obj);

            obj.position.y += 1;
        }
    );
}

function onModelReady() {
    // console.log("Model loaded");
    // console.log(itemModel);
	// sceneSync = new altspace.utilities.behaviors.SceneSync(
	// 	connection.instance, 
	// 	{
	// 		instantiators: { "Model" : createModelObject },
	// 		ready : ready
	// 	}
	// );
	// sim.scene.addBehavior(sceneSync);
}

// function ready() {
// 	sceneSync.instantiate("Model");
// }

// function createModelObject(initData) {
// 	item = itemModel.clone();
// 	item.addBehaviors(
// 		new altspace.utilities.behaviors.Object3DSync(
// 			{ position : true, rotation : true, scale : true }					
// 		)
// 	);
// 	sim.scene.add(item);
// 	return item;				
// }

</script>
</body>
</html>

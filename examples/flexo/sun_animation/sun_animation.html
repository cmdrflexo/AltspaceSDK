<!DOCTYPE html>
<html lang=en>
    <head>
        <script src = "https://cdn.rawgit.com/mrdoob/three.js/r84/build/three.js"></script>
        <script src = "https://sdk.altvr.com/libs/altspace.js/2.9.0/altspace.min.js"></script>
        <script src = "https://cdnjs.cloudflare.com/ajax/libs/tween.js/16.3.5/Tween.min.js"></script>
        <script src = "https://cdn.rawgit.com/NGenesis/altspacevr-behaviors/v1.0.0/js/altspaceutil.min.js"></script>
        <script src = "../motion/motion.js"></script>
    </head>
    <body>
        <script>
            var skyDayURL = "https://cmdrflexo.github.io/AltspaceSDK-Flexo/examples/flexo/images/sky/sky_test3.png";
            var skyNightURL = "https://cmdrflexo.github.io/AltspaceSDK-Flexo/examples/flexo/images/sky/galaxy.jpg";

            // var moonTextureURL = "https://cmdrflexo.github.io/AltspaceSDK-Flexo/examples/flexo/images/moon_quarterRes.jpg";
            var moonTextureURL = "https://cmdrflexo.github.io/AltspaceSDK-Flexo/examples/flexo/images/moon.jpg";
            var moonDarkTextureURL = "https://cmdrflexo.github.io/AltspaceSDK-Flexo/examples/flexo/images/alpha_test.png";

            var moonTextureDir = "https://cmdrflexo.github.io/AltspaceSDK-Flexo/examples/flexo/images/";
            var moonTextureAURL = moonTextureDir + "moon_quarterRes-A.jpg"
            var moonTextureBURL = moonTextureDir + "moon_quarterRes-B.jpg"
            var moonTextureCURL = moonTextureDir + "moon_quarterRes-C.jpg"
            var moonTextureDURL = moonTextureDir + "moon_quarterRes-D.jpg"
            var moonTextureEURL = moonTextureDir + "moon_quarterRes-E.jpg"
            var moonTextureFURL = moonTextureDir + "moon_quarterRes-F.jpg"
            var moonTextureGURL = moonTextureDir + "moon_quarterRes-G.jpg"
            var moonTextureHURL = moonTextureDir + "moon_quarterRes-H.jpg"

            altspaceutil.getFullspaceEnclosure().then(function(enclosure) {

                sim = new altspace.utilities.Simulation();
                
                var originReference = new THREE.Mesh(
                    new THREE.BoxGeometry(1, 0.1, 1),
                    new THREE.MeshBasicMaterial({ color: 0xffffff })
                )

                var groundPlane = new THREE.Mesh(
                    new THREE.PlaneGeometry(10000, 10000),
                    new THREE.MeshBasicMaterial({ color: 0x062116 })
                )
                groundPlane.rotation.x = THREE.Math.degToRad(-90);
                
                var moonA = TexturedSphere(6, moonTextureAURL);
                moonA.position.x = -10 * 3;
                moonA.position.y = 8;
                var moonB = TexturedSphere(6, moonTextureBURL);
                moonB.position.x = -10 * 2;
                moonB.position.y = 8;
                var moonC = TexturedSphere(6, moonTextureCURL);
                moonC.position.x = -10 * 1;
                moonC.position.y = 8;
                var moonD = TexturedSphere(6, moonTextureDURL);
                moonD.position.y = 8;

                var moonE = TexturedSphere(6, moonTextureEURL);
                moonE.position.x = -10 * 3;
                moonE.position.y = 20;
                var moonF = TexturedSphere(6, moonTextureFURL);
                moonF.position.x = -10 * 2;
                moonF.position.y = 20;
                var moonG = TexturedSphere(6, moonTextureGURL);
                moonG.position.x = -10 * 1;
                moonG.position.y = 20;
                var moonH = TexturedSphere(6, moonTextureHURL);
                moonH.position.y = 20;

                sim.scene.add(moonA);
                sim.scene.add(moonB);
                sim.scene.add(moonC);
                sim.scene.add(moonD);
                sim.scene.add(moonE);
                sim.scene.add(moonF);
                sim.scene.add(moonG);
                sim.scene.add(moonH);

                // var moon = TexturedSphere(6, moonTextureURL);
                // moon.position.x = 100;
                // moon.position.y = 50;
                // var moon = new THREE.Mesh(
                //         new THREE.SphereGeometry(6, 64, 32),
                //         new THREE.MeshBasicMaterial({
                //             color: 0xffffff,
                //             map: new THREE.Texture({ 
                //                 src: altspaceutil.getAbsoluteURL(moonTextureURL)
                //             })
                //         })
                //     );
                // moon.position.y = 8;
                
                // var moonDark = TexturedSphere(6.01, moonDarkTextureURL);
                // moonDark.position.x = 100;
                // moonDark.position.y = 50;
                // moonDark.position.y = 8;

                var skyDay = TexturedSphere(1600, skyDayURL);
                skyDay.rotation.z = THREE.Math.degToRad(-45);
                skyDay.scale.x = -1;

                var skyNight = TexturedSphere(1500, skyNightURL);
                skyNight.rotation.x = THREE.Math.degToRad(45);
                skyNight.scale.x = -1;
                skyNight.addBehavior(new SkyRotate(-2000));
                skyNight.addBehavior(new SkyFade(1, 1));
                
                sim.scene.add(originReference);
                sim.scene.add(groundPlane);
                // sim.scene.add(moon);
                // sim.scene.add(moonDark);
                sim.scene.add(skyNight);
                sim.scene.add(skyDay);
            

                function TexturedSphere(size, textureURL) {
                    var skySphere = new THREE.Mesh(
                        // new THREE.SphereGeometry(size, 32, 16),
                        new THREE.SphereGeometry(size, 64, 32),
                        new THREE.MeshBasicMaterial({
                            color: 0xffffff,
                            transparent : true,
                            map: new THREE.Texture({ 
                                src: altspaceutil.getAbsoluteURL(textureURL)
                            })
                        })
                    );
                    return skySphere;
                }
        });
        </script>
    </body>
</html>
